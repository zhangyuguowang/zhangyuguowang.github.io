<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2023年中国各省份经济与人口分布可视化（综合版）</title>

  <!-- 引入ECharts核心库和中国地图数据 -->
  <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts/map/js/china.js"></script>

  <style>
    body {
      font-family: "Microsoft YaHei", sans-serif;
      background-color: #f8f8f8;
      text-align: center;
      margin: 0;
      padding: 10px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
      overflow-x: auto;
    }
@media (max-width: 768px) {
  body {
    padding: 5px; 
  }
}
    
    .header {
      flex-shrink: 0;
      padding: 10px 0;
    }
    
    #map {
      flex: 1;
      width: 100%;
      min-height: 400px;
     min-width: 600px;
      background: #ffffff;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      padding: 10px;
      box-sizing: border-box;
    }
    #map {
  flex: 1;
  width: 100%;
  /* 移除 min-height: 400px; */
  min-height: 0; /* 允许缩小到0 */
  background: #ffffff;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  padding: 10px;
  box-sizing: border-box;
}

/* 修改响应式规则 */
@media (max-width: 480px) {
  #map {
    padding: 5px; /* 进一步减小内边距 */
  }
  
  /* 在小宽度下调整图例位置 */
  .control-group {
    flex-direction: column; /* 垂直排列按钮 */
    align-items: center;
  }
  
  h1 {
    font-size: 16px;
  }
  
  p {
    font-size: 11px;
  }
}
    
    .control-group {
      margin: 10px auto;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      flex-shrink: 0;
    }
    
    .control-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background-color: #409EFF;
      color: white;
      cursor: pointer;
      font-size: 12px;
    }
    
    .control-btn:hover {
      background-color: #337ECC;
    }
    
    /* 响应式调整 */
    @media (max-width: 768px) {
      .control-group {
        gap: 8px;
      }
      
      .control-btn {
        padding: 6px 12px;
        font-size: 11px;
      }
      
      h1 {
        font-size: 18px;
        margin: 5px 0;
      }
      
      p {
        font-size: 12px;
        margin: 5px 0;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>2023年中国各省份经济发展水平与人口分布</h1>
    <p>面状底色=人口密度，紫色圆点=人均GDP</p>
  </div>

  <!-- 控件区域 -->
  <div class="control-group">
    <button class="control-btn" id="toggleLabel">隐藏省份名称</button>
    <button class="control-btn" id="togglePoint">隐藏人均GDP圆点</button>
    <button class="control-btn" id="switchLegend">切换：滑动条图例</button>
    <button class="control-btn" id="resetMap">重置视图</button>
  </div>

  <!-- 地图容器 -->
  <div id="map"></div>

  <script>
    // 1. 初始化图表
    var myChart = echarts.init(document.getElementById('map'));

    // 2. 基础数据（包含经纬度信息）
    var densityData = [
      { name: '北京', value: 1332.32, gdp: 200204.50, center: [116.46, 39.92] },
      { name: '天津', value: 1144.58, gdp: 122707.48, center: [117.2, 39.13] },
      { name: '河北', value: 392.11, gdp: 59440.15, center: [114.48, 38.03] },
      { name: '山西', value: 221.19, gdp: 74143.84, center: [112.53, 37.87] },
      { name: '内蒙古', value: 20.92, gdp: 102783.81, center: [111.65, 40.82] },
      { name: '辽宁', value: 281.85, gdp: 72236.73, center: [123.43, 41.8] },
      { name: '吉林', value: 122.35, gdp: 57840.43, center: [125.35, 43.88] },
      { name: '黑龙江', value: 67.66, gdp: 51874.27, center: [126.63, 45.75] },
      { name: '上海', value: 2975.83, gdp: 189823.76, center: [121.48, 31.22] },
      { name: '江苏', value: 799.81, gdp: 150389.63, center: [118.78, 32.04] },
      { name: '浙江', value: 628.12, gdp: 124570.70, center: [120.19, 30.26] },
      { name: '安徽', value: 436.78, gdp: 76867.51, center: [117.27, 31.86] },
      { name: '福建', value: 337.47, gdp: 129942.62, center: [119.3, 26.08] },
      { name: '江西', value: 270.46, gdp: 71317.89, center: [115.85, 28.68] },
      { name: '山东', value: 641.10, gdp: 90950.58, center: [117.0, 36.65] },
      { name: '河南', value: 592.46, gdp: 60246.96, center: [113.65, 34.76] },
      { name: '湖北', value: 313.98, gdp: 95586.90, center: [114.31, 30.52] },
      { name: '湖南', value: 310.05, gdp: 76146.24, center: [113.0, 28.21] },
      { name: '广东', value: 707.24, gdp: 106778.81, center: [113.23, 23.16] },
      { name: '广西', value: 211.57, gdp: 54112.57, center: [108.33, 22.84] },
      { name: '海南', value: 296.56, gdp: 72384.08, center: [110.35, 20.02] },
      { name: '重庆', value: 387.43, gdp: 94458.57, center: [106.55, 29.57] },
      { name: '四川', value: 172.14, gdp: 71860.54, center: [104.06, 30.67] },
      { name: '贵州', value: 219.48, gdp: 54109.31, center: [106.71, 26.57] },
      { name: '云南', value: 121.95, gdp: 64243.53, center: [102.73, 25.04] },
      { name: '西藏', value: 3.04, gdp: 65552.60, center: [91.11, 29.97] },
      { name: '陕西', value: 192.20, gdp: 85491.07, center: [108.95, 34.27] },
      { name: '甘肃', value: 57.89, gdp: 48119.64, center: [103.73, 36.03] },
      { name: '青海', value: 8.53, gdp: 63957.91, center: [101.74, 36.56] },
      { name: '宁夏', value: 140.48, gdp: 72908.09, center: [106.27, 38.47] },
      { name: '新疆', value: 15.92, gdp: 73617.82, center: [87.68, 43.77] },
      { name: '香港', value: 6730.79, gdp: 359117.64, center: [114.17, 22.28] },
      { name: '澳门', value: 20718.18, gdp: 483984.20, center: [113.55, 22.19] },
      { name: '台湾', value: 647.03, gdp: 227467.53, center: [121.5, 25.03] }
    ];

    // 3. 计算圆点大小（根据容器大小动态调整）
    function getPointSize(gdpValue) {
      const containerWidth = document.getElementById('map').offsetWidth;
      const baseSize = Math.max(8, Math.min(25, containerWidth / 50)); // 根据容器宽度动态调整
      const minGdp = 48000;
      const maxGdp = 485000;
      const normalized = (gdpValue - minGdp) / (maxGdp - minGdp);
      return normalized * baseSize + 2;
    }

    // 4. 准备散点图数据 - 使用经纬度坐标
    var pointData = [];
    densityData.forEach(item => {
      if (item.center) {
        pointData.push({
          name: item.name,
          value: item.center.concat([item.gdp]), // [经度, 纬度, GDP值]
          gdp: item.gdp,
          density: item.value
        });
      }
    });

    // 5. 图例配置 - 关键修改：添加seriesIndex: 0，仅作用于地图系列
    var discreteLegend = {
      type: 'piecewise',
      seriesIndex: 0, // 只作用于第0个系列（人口密度地图）
      pieces: [
        { min: 0, max: 100, label: '0-100人/平方公里', color: '#0099FF' },
        { min: 101, max: 200, label: '101-200人/平方公里', color: '#33CC33' },
        { min: 201, max: 300, label: '201-300人/平方公里', color: '#FFFF00' },
        { min: 301, max: 600, label: '301-600人/平方公里', color: '#FF9900' },
        { min: 601, max: 21000, label: '601+人/平方公里', color: '#FF3333' }
      ],
      left: 10,
      bottom: 10,
      textStyle: { fontSize: 11, color: '#333' },
      orient: 'vertical',
      itemWidth: 15,
      itemHeight: 10
    };

    var continuousLegend = {
      type: 'continuous',
      seriesIndex: 0, // 只作用于第0个系列（人口密度地图）
      min: 0,
      max: 21000,
      left: 10,
      bottom: 10,
      text: ['高人口密度', '低人口密度'],
      textStyle: { fontSize: 11, color: '#333' },
      orient: 'vertical',
      inRange: {
        color: ['#0099FF', '#33CC33', '#FFFF00', '#FF9900', '#FF3333']
      },
      itemWidth: 15,
      itemHeight: 150
    };

    // 6. 创建基本配置
    var createOption = function() {
  var containerWidth = document.getElementById('map').offsetWidth;
  var containerHeight = document.getElementById('map').offsetHeight;
  
  // 根据容器宽度调整字体大小
  var titleFontSize = Math.max(12, Math.min(18, containerWidth / 30));
  var labelFontSize = Math.max(6, Math.min(10, containerWidth / 50));
  
  // 根据容器宽度调整图例位置和方向
  var isSmallScreen = containerWidth < 500;
  
  return {
    title: {
      text: '2023年中国各省份经济发展水平与人口分布',
      left: 'center',
      top: 5,
      textStyle: { fontSize: titleFontSize, fontWeight: 'bold' }
    },
        tooltip: {
          trigger: 'item',
          formatter: function(params) {
            if (params.seriesType === 'map') {
              var dataItem = densityData.find(item => item.name === params.name);
              if (dataItem) {
                return params.name + '<br/>' +
                       '人口密度: ' + dataItem.value.toFixed(2) + ' 人/平方公里<br/>' +
                       '人均GDP: ' + dataItem.gdp.toLocaleString() + ' 元';
              }
            } else if (params.seriesType === 'scatter') {
              return params.name + '<br/>人均GDP: ' + params.data.gdp.toLocaleString() + ' 元<br/>' +
                     '人口密度: ' + params.data.density.toFixed(2) + ' 人/平方公里<br/>' +
                     '圆点大小: ' + Math.round(getPointSize(params.data.gdp)) + ' 像素';
            }
            return params.name;
          }
        },
        visualMap: isContinuousLegend ? 
      (isSmallScreen ? 
        { // 小屏幕下的连续图例配置
          type: 'continuous',
          seriesIndex: 0,
          min: 0,
          max: 21000,
          left: 'center',
          bottom: 5,
          text: ['高密度', '低密度'],
          textStyle: { fontSize: 9, color: '#333' },
          orient: 'horizontal',
          inRange: { color: ['#0099FF', '#33CC33', '#FFFF00', '#FF9900', '#FF3333'] },
          itemWidth: 10,
          itemHeight: 80
        } : continuousLegend) : 
      (isSmallScreen ? 
        { // 小屏幕下的离散图例配置
          type: 'piecewise',
          seriesIndex: 0,
          pieces: [
            { min: 0, max: 100, label: '0-100', color: '#0099FF' },
            { min: 101, max: 200, label: '101-200', color: '#33CC33' },
            { min: 201, max: 300, label: '201-300', color: '#FFFF00' },
            { min: 301, max: 600, label: '301-600', color: '#FF9900' },
            { min: 601, max: 21000, label: '601+', color: '#FF3333' }
          ],
          left: 'center',
          bottom: 5,
          textStyle: { fontSize: 9, color: '#333' },
          orient: 'horizontal',
          itemWidth: 12,
          itemHeight: 8,
          itemGap: 5
        } : discreteLegend),
        
        geo: {
          map: 'china',
          roam: false,
          label: {
            show: labelShow,
            fontSize: labelFontSize
          },
          itemStyle: {
            normal: {
              areaColor: '#f0f0f0',
              borderColor: '#ccc',
              borderWidth: 0.5
            },
            emphasis: {
              areaColor: '#ffcc00'
            }
          },
          top: 30,
          bottom: 40
        },
        series: [
          {
            name: '人口密度',
            type: 'map',
            map: 'china',
            data: densityData,
            label: {
              show: labelShow,
              fontSize: labelFontSize
            },
            itemStyle: {
              borderColor: '#fff',
              borderWidth: 0.5,
              areaColor: '#f0f0f0'
            },
            emphasis: {
              itemStyle: {
                areaColor: '#ffcc00',
                borderColor: '#333',
                borderWidth: 1
              }
            },
            top: 30,
            bottom: 40
          },
          {
            name: '人均GDP',
            type: 'scatter',
            coordinateSystem: 'geo',
            symbol: 'circle',
            symbolSize: function(data) {
              return pointShow ? getPointSize(data[2]) : 0;
            },
            data: pointData,
            itemStyle: {
              color: '#d00080',
              borderColor: '#ffffff',
              borderWidth: 1.5,
              opacity: 1
            },
            emphasis: {
              itemStyle: {
                color: '#700080',
                borderColor: '#ffffff',
                borderWidth: 2,
                opacity: 1
              }
            },
            zlevel: 10,
            encode: {
              color: -1
            }
          }
        ]
      };
    };

    // 7. 状态变量
    var labelShow = true;
    var pointShow = true;
    var isContinuousLegend = false;

    // 8. 初始渲染
    function renderChart() {
      myChart.setOption(createOption(), true);
    }
    
    renderChart();

    // 9. 控件功能
    document.getElementById('toggleLabel').addEventListener('click', function() {
      labelShow = !labelShow;
      this.textContent = labelShow ? '隐藏省份名称' : '显示省份名称';
      renderChart();
    });

    document.getElementById('togglePoint').addEventListener('click', function() {
      pointShow = !pointShow;
      this.textContent = pointShow ? '隐藏人均GDP圆点' : '显示人均GDP圆点';
      renderChart();
    });

    document.getElementById('switchLegend').addEventListener('click', function() {
      isContinuousLegend = !isContinuousLegend;
      this.textContent = isContinuousLegend ? '切换：离散图例' : '切换：滑动条图例';
      renderChart();
    });

    document.getElementById('resetMap').addEventListener('click', function() {
      labelShow = true;
      pointShow = true;
      isContinuousLegend = false;
      document.getElementById('toggleLabel').textContent = '隐藏省份名称';
      document.getElementById('togglePoint').textContent = '隐藏人均GDP圆点';
      document.getElementById('switchLegend').textContent = '切换：滑动条图例';
      renderChart();
    });

    // 10. 窗口自适应
    var resizeTimer;
    window.addEventListener('resize', function() {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(function() {
        myChart.resize();
        renderChart();
      }, 200);
    });

    // 11. 添加对容器大小变化的监听（适用于Axure动态调整）
    var mapContainer = document.getElementById('map');
    var observer = new ResizeObserver(function() {
      myChart.resize();
      renderChart();
    });
    
    if (observer) {
      observer.observe(mapContainer);
    }
  </script>
</body>
</html>